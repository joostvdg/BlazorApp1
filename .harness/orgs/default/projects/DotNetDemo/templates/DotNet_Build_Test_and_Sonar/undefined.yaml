template:
  name: DotNet Build Test and Sonar
  type: Step
  projectIdentifier: DotNetDemo
  orgIdentifier: default
  spec:
    type: Run
    spec:
      connectorRef: dockerhub_joostvdg
      image: docker.io/caladreas/dotnet-nodejs-ci-builder:0.1.1
      shell: Bash
      command: |-
        dotnet --info
        dotnet tool restore
        dotnet sonarscanner begin \
          /k:"BlazorApp1" \
          /d:sonar.host.url="http://sonarqube-sonarqube.sonarqube.svc.cluster.local:9000"  \
          /d:sonar.token="sqa_a3643d525a9de2559aece8fb6df8e501b7770645" \
          /d:sonar.cs.vscoveragexml.reportsPaths=coverage.xml \
          /d:sonar.qualitygate.wait=true \
          /d:sonar.qualitygate.timeout=300
        dotnet tool run dotnet-coverage collect dotnet test BlazorApp1.sln --no-restore -f xml -o coverage.xml
        dotnet build BlazorApp1.sln --no-restore -p:Configuration=Release
        dotnet sonarscanner end /d:sonar.token="sqa_a3643d525a9de2559aece8fb6df8e501b7770645"
      resources:
        limits:
          memory: 3000Mi
          cpu: 1500m
  identifier: DotNet_Build_Test_and_Sonar
  versionLabel: 0.1.0
